@startuml TrackingAndReviewSequenceDiagram

!theme vibrant

' Định nghĩa các participants
actor "Người dùng" as User
participant "ui:TrackingAndReviewUI" as UI
participant "controller:TrackingController" as Controller
participant "service:TrackingService" as Service
participant "foodLogDAO:FoodLogDAO" as FoodLogDAO
participant "reportDAO:ReportDAO" as ReportDAO
participant "suggestionDAO:SuggestionDAO" as SuggestionDAO

' Kịch bản: Người dùng ghi lại bữa ăn và xem báo cáo

' === Ghi lại bữa ăn ===

User -> UI: Chọn "Ghi lại bữa ăn"
activate UI

UI -> UI: showLogCreationForm()

User -> UI: Nhập thông tin và nhấn "Lưu"
UI -> Controller: handleLogFood(userId, logData)
activate Controller

Controller -> Service: logFood(userId, foodLog)
activate Service

Service -> FoodLogDAO: save(foodLog)
activate FoodLogDAO

FoodLogDAO --> Service: foodLog
deactivate FoodLogDAO

Service --> Controller: foodLog
deactivate Service

Controller --> UI: success
deactivate Controller

UI --> User: Hiển thị thông báo "Lưu thành công"
deactivate UI

' === Xem báo cáo ===

User -> UI: Yêu cầu xem báo cáo tuần
activate UI

UI -> Controller: handleGenerateReport(userId, 'weekly')
activate Controller

Controller -> Service: generateProgressReport(userId, 'weekly')
activate Service

Service -> FoodLogDAO: findByUserAndDate(...)
activate FoodLogDAO
FoodLogDAO --> Service: List<FoodLog>
deactivate FoodLogDAO

' Giả sử có cả ActivityLogDAO được gọi
Service -> ReportDAO: save(report)
activate ReportDAO
ReportDAO --> Service: report
deactivate ReportDAO

Service --> Controller: report
deactivate Service

Controller -> Service: getAISuggestions(userId)
activate Service

Service -> suggestionDAO: findByUser(userId)
activate suggestionDAO
suggestionDAO --> Service: List<Suggestion>
deactivate suggestionDAO

Service --> Controller: suggestions
deactivate Service

Controller --> UI: report, suggestions
deactivate Controller

UI -> UI: displayReport(report)
UI -> UI: displaySuggestions(suggestions)

UI --> User: Hiển thị báo cáo và gợi ý
deactivate UI

@enduml
